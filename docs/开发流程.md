# 开发流程（全新制定）

> 本流程基于 **Tauri + Rust + SQLite** 项目实际进度重新梳理，旨在提升协作效率、代码质量和交付速度。所有团队成员请严格遵守。

## 1. 项目管理框架

- **采用 Scrum（两周 Sprint）**：每两周为一个 Sprint，结束时进行 Sprint Review 与 Retrospective。
- **看板（Kanban）**：使用 GitHub Projects（或类似工具）管理 `Backlog`、`In Progress`、`Review`、`Done` 四列。
- **任务粒度**：每个任务（User Story / Issue）应在 **4‑8 小时** 内可完成，便于评估与分配。

## 2. 需求与规划

1. **需求收集**：产品经理/需求方在 `docs/项目概览.md` 中补充功能描述。
2. **拆分子任务**：在 `docs/待办事项.md` 中为每个功能创建对应的 **Issue**，并标记优先级（P0‑P2）。
3. **Sprint 计划会议**：选取本 Sprint 的 P0/P1 任务，分配负责人，估算工时（Story Points）。

## 3. 开发规范

- **分支策略**
  - `main`：稳定发布分支，仅接受 PR 合并。
  - `dev`：当前开发分支，所有 Sprint 的合并目标。
  - `feature/<name>`：功能分支，基于 `dev` 创建。
  - `bugfix/<name>`：缺陷修复分支。
- **提交规范**：遵循 **Conventional Commits**（`feat:`、`fix:`、`docs:`、`refactor:` 等），自动生成 CHANGELOG。
- **代码格式化**：
  - Rust 使用 `cargo fmt`（`rustfmt`）
  - 前端使用 `prettier`（ESM、CSS）
- **静态检查**：
  - Rust：`cargo clippy`
  - 前端：`eslint` + `stylelint`

## 4. 代码评审（Code Review）

1. **PR 提交**：完成功能后提交 Pull Request，标题遵循 `feat(scope): description`。
2. **审查要求**：至少两名团队成员审查，必须通过以下检查才能合并：
   - 单元/集成测试通过
   - `cargo clippy` 与 `eslint` 无错误/警告（可配置为警告）
   - 文档更新（`docs/`）同步
3. **审查工具**：GitHub Review、自动化 CI 检查（见第 5 节）。

## 5. 持续集成 / 持续交付（CI/CD）

- **GitHub Actions 工作流**（已在 `.github/workflows/` 中配置）
  1. **Lint**：`cargo clippy`、`eslint`、`prettier` 检查。
  2. **Test**：运行 Rust 单元测试 `cargo test`，前端 Jest 测试。
  3. **Build**：`pnpm tauri build --target x86_64-pc-windows-msvc`（Windows）
  4. **Artifact**：生成可执行文件上传为 CI Artifact，供内部 QA 下载。
- **自动化发布**：当 `main` 分支通过所有检查并打上 `vX.Y.Z` 标签时，触发自动发布至 GitHub Releases。

## 6. 测试策略

| 层级 | 工具 | 目的 |
|------|------|------|
| 单元测试 | `cargo test` / `jest` | 验证函数/模块的业务逻辑 |
| 集成测试 | `tauri-driver`（自研） | 验证前后端交互、数据库 CRUD |
| UI 自动化 | `playwright`（可选） | 浏览器端交互回归 |
| 手动测试 | QA Checklist | 功能、兼容性、性能检查 |

> **测试覆盖率目标**：代码覆盖率 ≥ 80%。

## 7. 文档同步

- **每次功能完成**：在对应的 `docs/`（如 `API文档.md`、`使用指南.md`）中补全说明。
- **版本发布**：更新 `docs/更新日志/`，记录本次发布的新增/改动。
- **自动化**：使用 `mdbook` 或 `vitepress` 生成文档站点，部署至 GitHub Pages（可选）。

## 8. 迭代回顾（Retrospective）

每个 Sprint 结束后，团队进行 15 分钟回顾，记录以下三点：
1. **做得好的**（What went well）
2. **需要改进的**（What could be improved）
3. **行动计划**（Action items）

将行动计划写入 `docs/回顾.md`，并在下一个 Sprint 中跟踪。

## 9. 风险管理 & 关键里程碑

| 里程碑 | 关键交付物 | 负责人 | 预计完成时间 |
|--------|------------|--------|--------------|
| v0.1   | 基础框架、资源扫描、视频播放 | 全体 | 已完成（2026‑01‑15） |
| v0.2   | 元数据编辑、收藏/历史、UI 美化 | 前端/后端 | 2026‑02‑15 |
| v0.3   | 多库、局域网访问、移动适配 | 全体 | 2026‑03‑15 |
| v1.0   | 稳定发布、自动更新、插件体系 | 全体 | 2026‑04‑01 |

> **风险**：
- **技术债务**：未及时重构导致代码复杂度上升 → 每周一次代码审计。
- **文档滞后**：功能实现后忘记更新文档 → 将文档更新设为 PR 必须审查项。

---

**行动指引**：请团队成员立即在 `GitHub Projects` 中创建本 Sprint 的任务卡片，依据上述流程开展工作。祝开发顺利！
